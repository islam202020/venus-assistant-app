import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

// -------------------------------------------------------------------
// Helper Script to Add Initial Data (Run Once)
// -------------------------------------------------------------------
// This is a helper class to populate Firestore with the initial data
// from the Word document. You can add a button in the UI temporarily
// to call the `uploadAllData` method once. After the data is uploaded,
// you can remove the button and this class.
class DataUploader {
  final FirebaseFirestore _firestore = FirebaseFirestore.instance;

  // MODIFIED: Added a confirmation dialog to prevent accidental deletion.
  Future<void> uploadAllData(BuildContext context) async {
    // Show a confirmation dialog before proceeding.
    final confirmed = await showDialog<bool>(
      context: context,
      barrierDismissible: false,
      builder: (dialogContext) => AlertDialog(
        title: const Text('تحذير خطير'),
        content: const Text(
            'هذه العملية ستقوم بحذف جميع القطاعات والمشرفين والمنافذ الحالية واستبدالها بالبيانات الأساسية من الملف. هل أنت متأكد من رغبتك في المتابعة؟'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(dialogContext).pop(false),
            child: const Text('إلغاء'),
          ),
          ElevatedButton(
            style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
            onPressed: () => Navigator.of(dialogContext).pop(true),
            child: const Text('نعم، قم بالحذف والمتابعة'),
          ),
        ],
      ),
    );

    // If the user did not confirm, do nothing.
    if (confirmed != true) {
      return;
    }

    ScaffoldMessenger.of(context)
        .showSnackBar(const SnackBar(content: Text('جاري الحذف والرفع...')));

    // Clear existing data to avoid duplicates
    await _clearCollection('sectors');
    await _clearCollection('supervisors');
    await _clearCollection('outlets');

    // --- Data extracted from the Word document ---
    final allData = _getInitialData();

    for (var sectorData in allData) {
      // 1. Create Sector
      final sectorRef = await _firestore.collection('sectors').add({
        'name': sectorData['sectorName'],
        'managerName': sectorData['managerName'],
      });
      final sectorId = sectorRef.id;

      for (var supervisorData in sectorData['supervisors']) {
        // 2. Create Supervisor
        final supervisorRef = await _firestore.collection('supervisors').add({
          'name': supervisorData['supervisorName'],
          'sectorId': sectorId,
        });
        final supervisorId = supervisorRef.id;

        for (var outletData in supervisorData['outlets']) {
          // 3. Create Outlet
          await _firestore.collection('outlets').add({
            'number': outletData['number'],
            'phone': outletData['phone'],
            'address': outletData['address'],
            'supervisorId': supervisorId,
            'sectorId': sectorId,
          });
        }
      }
    }
    ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('اكتمل رفع البيانات بنجاح!')));
  }

  Future<void> _clearCollection(String collectionName) async {
    final snapshot = await _firestore.collection(collectionName).get();
    for (final doc in snapshot.docs) {
      await doc.reference.delete();
    }
  }

  // This method contains all the data from the document
  List<Map<String, dynamic>> _getInitialData() {
    return [
      {
        "sectorName": "القاهرة (أ)",
        "managerName": "على رمضان على",
        "supervisors": [
          {
            "supervisorName": "احمد ابراهيم",
            "outlets": [
              {
                "number": "1",
                "phone": "01200404034",
                "address": "مدينة الرحاب - صنية الرحاب"
              },
              {
                "number": "7",
                "phone": "01280007218",
                "address":
                    "التجمع الخامس - ميدان حسن فتحي - فاطمة الشربتلى - بجوار مسجد الشربتلى"
              },
              {
                "number": "11",
                "phone": "01206015172",
                "address":
                    "التجمع الخامس - ش الـ90 الجنوبي - أمام كليوبترا التسعين"
              },
              {
                "number": "29",
                "phone": "01212999884",
                "address": "التجمع الخامس - ش الـ90 الجنوبي امام البنك الاهلي"
              },
              {
                "number": "218",
                "phone": "01200391555",
                "address":
                    "القاهرة - كمباوند الرحاب - البوابة 6 - مدخل السوق القديم"
              },
              {
                "number": "219",
                "phone": "01276187937",
                "address": "القاهرة - كمباوند الرحاب - أمام مول الرحاب 2"
              },
              {
                "number": "224",
                "phone": "01272564937",
                "address":
                    "التجمع الخامس - آخر ش التسعين الجنوبى - فى الجهة المقابلة لبوابة نادى رويال الرئيسية"
              },
              {
                "number": "228",
                "phone": "01286749463",
                "address":
                    "التجمع الخامس - طريق النصر - أمام Mountain view 2 - فالجهة المقابلة لنادى بلاتينيوم"
              },
              {
                "number": "229",
                "phone": "01206187633",
                "address":
                    "التجمع الخامس - فى الجهة المقابلة للجامعة الامريكية - بجوار مول The Spot"
              },
            ]
          },
          {
            "supervisorName": "محمود عبدالفتاح",
            "outlets": [
              {
                "number": "2",
                "phone": "01200404032",
                "address": "مدينة نصر - البوابة الخلفية للنادي الأهلي"
              },
              {
                "number": "25",
                "phone": "01200089848",
                "address": "مدينة نصر - ش مصطفى النحاس تقاطع ش عباس العقاد"
              },
              {
                "number": "36",
                "phone": "01220426669",
                "address":
                    "مدينة نصر - الحى السابع - مسجد السلام - أمام بنزينة وطنية ."
              },
              {
                "number": "85",
                "phone": "01200092462",
                "address": "زهراء مدينة نصر - الحى العاشر - بجوار محطة العيادة"
              },
              {
                "number": "128",
                "phone": "01203717989",
                "address":
                    "مدينة نصر - ش المعصراوى - إمتداد ش مصطفى النحاس - بجوار سوبر ماركت المحلاوى"
              },
              {
                "number": "145",
                "phone": "01206346402",
                "address":
                    "مدينة نصر - ش حسن المأمون - بجوار البوابة الامامية للنادى الاهلى"
              },
              {
                "number": "193",
                "phone": "01200497936",
                "address":
                    "مدينة نصر - الحى السابع - فى الجهة المقابلة للتوحيد والنور"
              },
              {
                "number": "197",
                "phone": "01276187388",
                "address":
                    "مدينة نصر - الحى العاشر - محور مهدي عرفة - بجوار رايه ماركت"
              },
              {
                "number": "296",
                "phone": "01282945260",
                "address":
                    "مدينة نصر - شارع اسماعيل القبانى -بجوار دار مناسبات السيدة فاطمة الزهراء"
              },
              {
                "number": "297",
                "phone": "01282945261",
                "address":
                    "زهراء مدينة نصر - إتجاة الحى العاشر - شارع احمد الزمر - الجهة المقابلة لمول رنين"
              },
            ]
          },
          {
            "supervisorName": "محمد كمال",
            "outlets": [
              {
                "number": "45",
                "phone": "01212577669",
                "address": "التجمع الخامس - فى الجهة المقابلة لمول سفن ستارز"
              },
              {
                "number": "54",
                "phone": "01207806063",
                "address":
                    "التجمع الاول - محور مصطفي كامل الجهه المقابله لبنزينه fuel up"
              },
              {
                "number": "167",
                "phone": "01271358071",
                "address":
                    "التجمع الخامس - شارع التسعين الشمالى - أمام إستاد بترو سبورت"
              },
              {
                "number": "211",
                "phone": "01273935862",
                "address": "التجمع الاول - صنية الشباب - أمام المشتل"
              },
              {
                "number": "242",
                "phone": "01273937973",
                "address":
                    "التجمع الخامس - ش التسعين الشمالى - الجهة المقابلة لسوبر ماركت مؤمن و بشار"
              },
              {
                "number": "262",
                "phone": "01280782205",
                "address":
                    "التجمع الاول - قبل مدخل محور مصطفى كامل - امام سنترال التجمع الاول - بجوار موقف الاتوبيس"
              },
              {
                "number": "267",
                "phone": "01286798305",
                "address":
                    "التجمع الخامس - أمام جهاز مدينة التجمع - أمام المدرسة الرسمية للغات"
              },
              {
                "number": "268",
                "phone": "01286798586",
                "address": "التجمع الخامس - صنية الخزان"
              },
              {
                "number": "283",
                "phone": "01282945206",
                "address":
                    "التجمع الخامس - ش التسعين الشمالى - فى الجهة المقابلة للنيابة الادارية - بعد حزب الشعب الجمهورى"
              },
            ]
          }
        ]
      },
      {
        "sectorName": "أكتوبر",
        "managerName": "احمد رفعت",
        "supervisors": [
          {
            "supervisorName": "حسن سيد",
            "outlets": [
              {
                "number": "3",
                "phone": "01200404035",
                "address": "طريق الواحات - هضبة الاهرام - البوابة الرابعة"
              },
              {
                "number": "39",
                "phone": "01275174018",
                "address": "مدخل نادي وادي دجلة بجوارمول مصر طريق الواحات"
              },
              {
                "number": "227",
                "phone": "01286748193",
                "address": "اكتوبر - حدائق أكتوبر - منطقة 247 - بجوار مول الحسن"
              },
              {
                "number": "244",
                "phone": "01279693399",
                "address":
                    "حائق أكتوبر - مدخل 2 - طريق الواحات - مدخل سوق الجملة"
              },
              {
                "number": "245",
                "phone": "01207811888",
                "address":
                    "حدائق أكتوبر - طريق الواحات - بجوار مدينة الفردوس - فى الجهة المقابلة لدريم لاند"
              },
              {
                "number": "248",
                "phone": "01284419515",
                "address": "مدخل حدائق أكتوبر - النايل سات"
              },
              {
                "number": "249",
                "phone": "01284419521",
                "address":
                    "الطريق الفرعى من طريق مول مصر - طريق الواحات - ناصية مدخل مركز تدريب النقل"
              },
              {
                "number": "301",
                "phone": "01286455792",
                "address": "طريق الواحات - بعد نزلة الدائرى - أمام بنزينة وطنية"
              },
              {
                "number": "308",
                "phone": "01286455780",
                "address":
                    "حدائق أكتوبر - فى الجهة المقابلة لجولف مول - وبجوار المكتب الفنى"
              }
            ]
          },
          {
            "supervisorName": "حسام احمد",
            "outlets": [
              {
                "number": "13",
                "phone": "01206015269",
                "address": "الشيخ زايد - خلف هايبر (1)"
              },
              {
                "number": "14",
                "phone": "01206015516",
                "address":
                    "الشيخ زايد - ميدان اسبكترا - أمام المجمع الاسلامى والمسجد الكبير بزايد"
              },
              {
                "number": "53",
                "phone": "01205624222",
                "address":
                    "مدينة 6 أكتور - فى الجهة المقابلة لمسجد الشيخ الحصري - امام برج الامريكية."
              },
              {
                "number": "199",
                "phone": "01211449477",
                "address": "الشيخ زايد ــ فى الجهة المقابلة لمزار مول"
              },
              {
                "number": "222",
                "phone": "01203446227",
                "address":
                    "الجيزة - الشيخ زايد - مدخل زايد (3) - بجوار معرض سيارات البرجسى - وبجوار بنزينة توتال ."
              },
              {
                "number": "223",
                "phone": "01288487334",
                "address":
                    "الجيزة - مدينة الشيخ زايد - م سيراميكا جرانيتو ( ميدان الامل ) - اول طريق الشباب"
              },
              {
                "number": "237",
                "phone": "01282530863",
                "address":
                    "أول مدخل الحى المتميز - من مدخل ميدان رامو - بجوار جامعة مصر"
              },
              {
                "number": "305",
                "phone": "01286455725",
                "address":
                    "أكتوبر - محور 26 يوليو - مدخل مول الصفوة - الطريق البطئ أعلى الرصيف."
              }
            ]
          },
          {
            "supervisorName": "مصطفي سراج",
            "outlets": [
              {
                "number": "16",
                "phone": "01206015594",
                "address": "اكتوبر- امام جهاز مدينة 6 اكتوبر- شارع النباتات"
              },
              {
                "number": "21",
                "phone": "01200500923",
                "address":
                    "أكتوبر - أمام البوابة الخلفية لجامعة 6 اكتوبر- بجوار صيدلية العزبى - بالقرب من EAGLE للملابس"
              },
              {
                "number": "181",
                "phone": "01206198108",
                "address": "أكتوبر - منطقة ال 800 فدان - ميدان الستين ."
              },
              {
                "number": "183",
                "phone": "01270981885",
                "address":
                    "أكتوبر - الحى الرابع - طريق التحرير - أمام مسجد عماد محمد راغب"
              },
              {
                "number": "191",
                "phone": "01202015825",
                "address":
                    "الحى السادس - شارع السنترال - فى الجهة المقابلة لموقف دجله بالمز وال 800 فدان ."
              },
              {
                "number": "200",
                "phone": "01206221553",
                "address":
                    "أكتوبر - ميدان فودافون - الحارة البطيئة - ناحية كشرى رسلان"
              },
              {
                "number": "236",
                "phone": "01282530857",
                "address":
                    "تقاطع محور جمال عبدالناصر مع التوسعات الشمالية - أمام كومباوند جاردينيا الشمس ."
              },
              {
                "number": "240",
                "phone": "01282530875",
                "address":
                    "مدينة 6 اكتوبر _ محور جمال عبد الناصر - الجهة المقابلة لكومباوند ديارا التعمير 1"
              },
              {
                "number": "307",
                "phone": "01286455743",
                "address":
                    "أكتوبر - المحور المركزى ( طريق النصر ) - فى الجهة المقابلة لمول رنا مول - بجوا ر صبحى سعيد للسيراميك"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "شباب المستقبل",
        "managerName": "احمد جمال",
        "supervisors": [
          {
            "supervisorName": "احمد عبدالمنعم",
            "outlets": [
              {
                "number": "4",
                "phone": "01200404036",
                "address":
                    "مصر الجديدة - جسر السويس - ش طه حسين - بجوار المستشفى السعودية الالمانية"
              },
              {
                "number": "10",
                "phone": "01210212180",
                "address":
                    "مصر الجديدة - الشيراتون - بجوار فندق رديسون بلو - من شارع عبد الحميد بدوي"
              },
              {
                "number": "18",
                "phone": "01200500649",
                "address":
                    "مدينة نصر - ش يوسف عباس تقاطع ش ابن فضلان - أمام بوابة نادى الزهور"
              },
              {
                "number": "19",
                "phone": "01200500751",
                "address":
                    "مصر الجديدة - النزهة - ش جوزيف تيتو - أمام ملاهى السندباد"
              },
              {
                "number": "63",
                "phone": "01207810080",
                "address":
                    "مدينة نصر - ش مكرم عبيد - أمام مول سيتى سنتر - بجوار B.TECH - وصيدلية العزبى"
              },
              {
                "number": "95",
                "phone": "01283399543",
                "address": "مدينة نصر - ميدان الساعة"
              },
              {
                "number": "173",
                "phone": "01206191882",
                "address": "السلام - مدينة السلام - الموقف العاشر القديم"
              },
              {
                "number": "201",
                "phone": "01271561999",
                "address": "مدينة نصر - ش عباس العقاد - بجوار ماكدونالدز"
              },
              {
                "number": "295",
                "phone": "01282945257",
                "address": "مدينة نصر - آخر شارع مكرم عبيد"
              },
              {
                "number": "302",
                "phone": "01286455791",
                "address":
                    "مصر الجديدة - اخر شارع النزهة تقاطع مع شارع الحرية - السبع عمارات"
              }
            ]
          },
          {
            "supervisorName": "محمود مرجان",
            "outlets": [
              {
                "number": "8",
                "phone": "01280007215",
                "address": "مصر الجديدة - ميدان روكسى من شارع احمد وفيق"
              },
              {
                "number": "15",
                "phone": "01206015582",
                "address": "مصر الجديده - أمام ألبوابه الثانيه لنادي الشمس"
              },
              {
                "number": "17",
                "phone": "01200522850",
                "address":
                    "مصرالجديدة - كوبرى القبة - شارع المطرية - بجوار القصر الجمهورى"
              },
              {
                "number": "24",
                "phone": "01200092490",
                "address":
                    "مصر الجديدة - ميدان سانت فاتيما - فى الجهة المقابلة لكنيسية العذراء سانت فاتيما"
              },
              {
                "number": "50",
                "phone": "01207805999",
                "address": "مصر الجديدة - بجوار محطة مترو كلية البنات"
              },
              {
                "number": "146",
                "phone": "01206344210",
                "address": "حدايق القبة - أمام مسجد الشيخ غراب"
              },
              {
                "number": "212",
                "phone": "01273935603",
                "address": "القاهرة - جسر السويس - بجوار نادى النخيل"
              },
              {
                "number": "231",
                "phone": "01279688595",
                "address": "القاهرة - حى مصر الجديدة - ميدان هليوبليس"
              },
              {
                "number": "265",
                "phone": "01280782230",
                "address":
                    "الاميرية - ميدان شركات الادوية - بجوار كشك دبشه - امام بنزينة توتال"
              }
            ]
          },
          {
            "supervisorName": "احمد عبد القادر",
            "outlets": [
              {
                "number": "66",
                "phone": "01205583222",
                "address":
                    "مصر الجديدة - الالف مسكن - بجوار محطة مترو الالف مسكن"
              },
              {
                "number": "83",
                "phone": "01211044730",
                "address":
                    "مصر الجديدة - ش جسر السويس - بجوار سنترال مصر الجديده - بعد كوبرى التجنيد"
              },
              {
                "number": "84",
                "phone": "01211447039",
                "address": "المرج الجديدة - بجوار محطة مترو الانفاق"
              },
              {
                "number": "94",
                "phone": "01211444978",
                "address": "عين شمس - مزلقان عين شمس سابقاً - اسفل الكوبرى"
              },
              {
                "number": "131",
                "phone": "01206296448",
                "address": "مصر الجديدة - ش هارون الرشيد"
              },
              {
                "number": "188",
                "phone": "01206317784",
                "address": "عزبة النخل - أمام عصارة التوفيقية"
              },
              {
                "number": "196",
                "phone": "01271254459",
                "address":
                    "مصر الجديدة - ميدان الاسماعيلية - الجهة المقابلة لبنزينة موبيل"
              },
              {
                "number": "285",
                "phone": "01282945211",
                "address": "القاهرة - ميدان الكوربة - بجوار الحرية مول"
              },
              {
                "number": "288",
                "phone": "01282945219",
                "address":
                    "القاهرة - حلمية الزيتون - ميدان الحلمية - أمام كافية السعداوى"
              },
              {
                "number": "310",
                "phone": "01282946239",
                "address":
                    "حى النزهة - ش جسر السويس - اول جمال عبدالناصر - بجوار شركة فالكون"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "الجيزة",
        "managerName": "عمرو بيومى",
        "supervisors": [
          {
            "supervisorName": "مصطفى ضيف",
            "outlets": [
              {
                "number": "5",
                "phone": "01200404037",
                "address":
                    "الجيزة - الدقى - أول ش nادى الصيد - الجهة المقابلة لشارع سليمان جوهر"
              },
              {
                "number": "20",
                "phone": "01200500818",
                "address":
                    "الجيزة - المهندسين - ميدان مصطفي محمود - أول شارع سوريا"
              },
              {
                "number": "44",
                "phone": "01280537307",
                "address":
                    "الجيزة - الكيت كات - بجوار شركة مياه الرى - من شارع جمال عبد الناصر"
              },
              {
                "number": "57",
                "phone": "01207810040",
                "address":
                    "الجيزة - العجوزه - شارع جمال عبد الناصر - بجوار مسرح البالون ( مسرح السامر )"
              },
              {
                "number": "160",
                "phone": "01276187815",
                "address": "الجيزة - بشتيل - أمام محطة قطارات بشتيل الجديدة"
              },
              {
                "number": "185",
                "phone": "01276187964",
                "address":
                    "الجيزة - إمبابة - ميدان حسين مهران - امام حديقة سفارى بارك."
              },
              {
                "number": "190",
                "phone": "01201384063",
                "address": "الجيزة - فيصل - أخر ش العشرين - أسفل محور صفط اللبن"
              },
              {
                "number": "234",
                "phone": "01279688629",
                "address":
                    "الجيزة - محطة مترو البحوث - 6 شارع التحرير - أمام مقار للسيارات"
              },
              {
                "number": "247",
                "phone": "01288376652",
                "address": "الجيزة - احمد عرابى - ش صلاح جاهين - أمام عمر افندى"
              }
            ]
          },
          {
            "supervisorName": "عصام هلال",
            "outlets": [
              {
                "number": "22",
                "phone": "01200506618",
                "address":
                    "الجيزة - شارع خاتم المرسلين -أمام الشركة الشرقية أخر ش الكهرباء - أمام قهوة جمعة"
              },
              {
                "number": "64",
                "phone": "01207801777",
                "address": "الجيزة - البحر الاعظم - بجوار نزلت دائرى المنيب"
              },
              {
                "number": "225",
                "phone": "01206113557",
                "address":
                    "الجيزة - تقاطع شارع الهرم مع نصر الدين - بجوار هيئة النقل العام"
              },
              {
                "number": "279",
                "phone": "01287436805",
                "address": "الجيزة - بجوار حديقة محطة قطار الجيزة"
              },
              {
                "number": "289",
                "phone": "01282945225",
                "address": "الجيزة - شارع ترسا - بجوار معرض سيجما ."
              },
              {
                "number": "293",
                "phone": "01282945243",
                "address":
                    "نزلة التجمع الخامس والمعادى - بجوار سور شركة بدر للنقل العام - مترو المنيب."
              },
              {
                "number": "294",
                "phone": "01282945246",
                "address": "الجيزة - ش الثلاثينى - بجوار سور اكاديمية الفنون"
              },
              {
                "number": "300",
                "phone": "01282945269",
                "address": "الجيزة - شارع خاتم المرسلين - أمام اكاديمية الفنون"
              }
            ]
          },
          {
            "supervisorName": "على خالد",
            "outlets": [
              {
                "number": "23",
                "phone": "01200522614",
                "address": "الجيزة - لليبيني هرم - بجوار مدرسه بيراميدز"
              },
              {
                "number": "49",
                "phone": "01205587222",
                "address":
                    "الجيزة - ش فيصل الرئيسي - أمام ش ضياء - أمام شركة فريش للأدوات الكهربائية."
              },
              {
                "number": "60",
                "phone": "01205621222",
                "address": "فيصل - شارع اللبينى - أمام مدرسة علوى"
              },
              {
                "number": "100",
                "phone": "01211444908",
                "address":
                    "الجيزة - الطوابق - فيصل - الجهة المقابلة لصيدلية العزبى"
              },
              {
                "number": "246",
                "phone": "01207821555",
                "address":
                    "الجيزة - اول نفق الليبيني فيصل من شارع فيصل الرئيسي - الجهه المقابله لحلواني الفاليرو"
              },
              {
                "number": "280",
                "phone": "01287436809",
                "address":
                    "الجيزة - شارع الملك فيصل - بجوار سور كلية التربية الرياضية"
              },
              {
                "number": "290",
                "phone": "01282945238",
                "address": "الجيزة - فيصل - المطبعة - أمام مطعم الشبراوي"
              },
              {
                "number": "318",
                "phone": "01210281185",
                "address":
                    "الجيزة - اخر فيصل - بعد فندق بيراميدز الاتجاه المؤدي لميدان الرمايه ."
              }
            ]
          },
          {
            "supervisorName": "محمود شديد",
            "outlets": [
              {
                "number": "72",
                "phone": "01205687222",
                "address": "الجيزة - الوراق - أمام وزارة الرى"
              },
              {
                "number": "168",
                "phone": "01206371274",
                "address":
                    "الجيزة - الوراق ــ بجوار الادارة التعليمية - أمام قسم شرطة الوراق"
              },
              {
                "number": "174",
                "phone": "01206309188",
                "address":
                    "الجيزة - إمبابة - ش الوحدة - بجوار مسجد المحافظ - ومحطة مترو البوهي"
              },
              {
                "number": "177",
                "phone": "01206318062",
                "address":
                    "الجيزة - حدائق الاهرام - البوابه الرابعه مدخل بوابه مينا - ميدان الجيش"
              },
              {
                "number": "214",
                "phone": "01273936516",
                "address":
                    "الجيزة - ميدان لبنان - إتجاة محور 26 يوليو - اسفل كوبرى ميدان لبنان"
              },
              {
                "number": "220",
                "phone": "01207806030",
                "address":
                    "الجيزة - حدائق الاهرام - البوابة الاولى - بجانب سور شركة الكهرباء- أمام صيدلية د / أمجد ."
              },
              {
                "number": "221",
                "phone": "01200361555",
                "address":
                    "حدائق الاهرام - بجوار سور نادى حدائق الاهرام (Anderlecht) - فى الجهة المقابلة للضغط العالى - بجوار اسواق أولاد رجب"
              },
              {
                "number": "316",
                "phone": "01223732212",
                "address":
                    "الجيزة - ارض اللواء - اسفل كوبرى المزلقان - فى الجهة المقابلة لمطعم جحا"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "جنوب القاهرة",
        "managerName": "هانى عبدالحكيم",
        "supervisors": [
          {
            "supervisorName": "هانى عبدالحكيم",
            "outlets": [
              {
                "number": "6",
                "phone": "01280007216",
                "address": "المعادى -م جراند مول"
              },
              {
                "number": "9",
                "phone": "01280007220",
                "address": "زهراء المعادي امام خير زمان"
              },
              {
                "number": "75",
                "phone": "01211446913",
                "address": "دار السلام - أمام مجمع مدارس دأر السلام"
              },
              {
                "number": "152",
                "phone": "01206296531",
                "address": "المعادي ــ ميدان الحرية"
              },
              {
                "number": "169",
                "phone": "01206371728",
                "address": "المعادي - شارع البحث الجنائي - ميدان صقر قريش"
              },
              {
                "number": "172",
                "phone": "01206248471",
                "address":
                    "المعادى ــ ش مصر حلوان الزراعى - أمام بنزينة (توتال دينا ) - خلف ابراج عثمان - خلف المستشفى العسكرى للقوات المسلحة"
              },
              {
                "number": "251",
                "phone": "01284419529",
                "address": "المعادى - شارع الخمسين - امام كافية خلخال"
              }
            ]
          },
          {
            "supervisorName": "عمرو سامى",
            "outlets": [
              {
                "number": "12",
                "phone": "01206015219",
                "address": "المقطم - ش 9 - بنزينة توتال - أمام ابو مازن السورى"
              },
              {
                "number": "31",
                "phone": "01210287675",
                "address": "المنيل - ميدان الباشا"
              },
              {
                "number": "65",
                "phone": "01207805888",
                "address": "المعادى - أمام أديدس - بجوار كارفور dائرى المعادى"
              },
              {
                "number": "142",
                "phone": "01224993803",
                "address":
                    "المقطم - شارع 9 - الجهة المقابلة لعيادات شارع 9 - وبجوار نادى المقطم وكشك أمان"
              },
              {
                "number": "150",
                "phone": "01227861457",
                "address": "المقطم -الهضبة الوسطي ش 33 من شارع الجامعة الحديثة."
              },
              {
                "number": "213",
                "phone": "01273935618",
                "address":
                    "حى المقطم - امام مدينة عباد الرحمن - بجوار النساجون الشرقيون ."
              },
              {
                "number": "232",
                "phone": "01279688612",
                "address": "مصر القديمة - مدينه الفسطاط - بجوار مول رنين وبروج"
              },
              {
                "number": "243",
                "phone": "01282530750",
                "address":
                    "المقطم ش 9 - المفارق - بجوار قسم المقطم - مستشقى المقطم التخصصى"
              }
            ]
          },
          {
            "supervisorName": "محمد حسن كامل",
            "outlets": [
              {
                "number": "88",
                "phone": "01283398854",
                "address": "مدينة حلوان - ميدان الشهداء"
              },
              {
                "number": "115",
                "phone": "01206160602",
                "address": "المعصرة - كورنيش النيل - بجوار المعدية"
              },
              {
                "number": "141",
                "phone": "01225307206",
                "address": "مدينة 15 مايو - ميدان مجاورة 15 - أمام بنزينة OLA"
              },
              {
                "number": "216",
                "phone": "01273936530",
                "address":
                    "المعادى- ميدان مؤمن - فى الجهة المقابلة للنساجون الشرقيون"
              },
              {
                "number": "230",
                "phone": "01286801602",
                "address": "القاهرة - المعادى - ميدان الجزائر"
              },
              {
                "number": "233",
                "phone": "01279688631",
                "address":
                    "حدائق حلوان - محطة مترو حدائق حلوان - أمام هايبر ماركت أسواق الخير"
              },
              {
                "number": "235",
                "phone": "01279688603",
                "address":
                    "حى رجال الاعمال - المجاورة الثالثة - 15 مايو - بجوار مدرسة الصفوة وبنك مصر"
              },
              {
                "number": "281",
                "phone": "01282945204",
                "address": "حلوان - بجوار محطة مترو حلوان"
              },
              {
                "number": "291",
                "phone": "01282945240",
                "address":
                    "المقطم - أول شارع الكهرباء - ميدان الحمد أمام مسجد المقطم"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "القاهرة شرق",
        "managerName": "محمد مبروك",
        "supervisors": [
          {
            "supervisorName": "السيد على احمد",
            "outlets": [
              {
                "number": "26",
                "phone": "01200092342",
                "address":
                    "مدينة العبور - الحى الخامس - الجهة المقابلة لصنية الخامس - ناحية B.TECH"
              },
              {
                "number": "51",
                "phone": "01210279645",
                "address":
                    "مدينة الشروق - شارع جمال عبد الناصر - فى الجهة المقابلة لحديقة أهل مصر."
              },
              {
                "number": "58",
                "phone": "01207806062",
                "address": "مدينة الشروق - طريق الشباب - أمام شركة المياة"
              },
              {
                "number": "92",
                "phone": "01283399355",
                "address": "العبور- مساكن الشباب - بجوار سنتر الياسمين"
              },
              {
                "number": "180",
                "phone": "01206368873",
                "address": "العبور - مدخل نفق الحى السابع"
              },
              {
                "number": "207",
                "phone": "01273935827",
                "address": "القاهرة - مدينة بدر - بجوار صنية الجامعة الروسية"
              },
              {
                "number": "210",
                "phone": "01273935815",
                "address": "القاهرة - كمباوند مدينتى - بجوار موقف الاتوبيس"
              },
              {
                "number": "241",
                "phone": "01273937961",
                "address":
                    "مدينة الشروق - إسكان 100 - شارع جمال عبد الناصر - امام مسجد الفاروق ."
              },
              {
                "number": "299",
                "phone": "01286455801",
                "address":
                    "مدينة بدر - الاسكان الاجتماعى - ميدان احمد عرابى - صنية بشندى ."
              }
            ]
          },
          {
            "supervisorName": "أحمد سامى",
            "outlets": [
              {
                "number": "35",
                "phone": "01220476669",
                "address": "العاشر من رمضان - أمام القصر الثقافى"
              },
              {
                "number": "68",
                "phone": "01205694222",
                "address":
                    "الشرقية - الزقازيق - أمام مستشفى المبره للتأمين الصحي"
              },
              {
                "number": "77",
                "phone": "01211447594",
                "address": "الشرقية - الزقازيق - أمام محطة القطار"
              },
              {
                "number": "90",
                "phone": "01283398800",
                "address": "الشرقية - فاقوس - أمام مسجد العطار"
              },
              {
                "number": "113",
                "phone": "01211308622",
                "address":
                    "الشرقية - مينا القمح - ميدان الشهيد احمد المنسي - بجوار بنك القاهرة - وبجوار كريب الثورة"
              },
              {
                "number": "122",
                "phone": "01202399902",
                "address":
                    "الشرقية - ديرب نجم - أمام مسجد النصر ( الجامع الكبير )"
              },
              {
                "number": "250",
                "phone": "01284419525",
                "address":
                    "الشرقية - مدينة بلبيس - طريق بلبيس الزقازيق - فى الجهة المقابلة لمسجد الكويتية"
              },
              {
                "number": "263",
                "phone": "01280782208",
                "address": "مدينة العاشر من رمضان - بجوار مدرسة السلطان العويس"
              },
              {
                "number": "274",
                "phone": "01210277883",
                "address":
                    "محافظة الشرقية - العاشر من رمضان - اخر موقف الاردنيه - أمام كشرى هند."
              },
              {
                "number": "277",
                "phone": "01287436801",
                "address":
                    "محافظة الشرقية - مدينة ابو حماد - أمام بنك مصر ومكتب البريد"
              }
            ]
          },
          {
            "supervisorName": "رضا محمد",
            "outlets": [
              {
                "number": "89",
                "phone": "01283398856",
                "address":
                    "محافظة بورسعيد - حى المناخ - ش 23 يوليو - بجوار حديقة الامل - فى الجهة المقابلة لمسجد صالح سليم"
              },
              {
                "number": "109",
                "phone": "01210241895",
                "address":
                    "دمياط – ميدان المطري - أمام شركة الكهرباء - قبل سور المدرسة الابتدائيه"
              },
              {
                "number": "112",
                "phone": "01200404026",
                "address": "الاسماعيلية - ش الثلاثينى - أمام كافية كوكب الشرق"
              },
              {
                "number": "139",
                "phone": "01270978892",
                "address":
                    "دمياط القديمة - ميدان الشهابية - بجوار سور مدرسة النصر"
              },
              {
                "number": "162",
                "phone": "01276187523",
                "address": "الاسماعيلية - ش العشرينى - أمام موقف مصر"
              },
              {
                "number": "163",
                "phone": "01276187516",
                "address":
                    "محافظة بورسعيد - حى المناخ - ميدان الصيادين - مساكن اللانش - امام الشهر العقارى"
              },
              {
                "number": "306",
                "phone": "01286455765",
                "address":
                    "محافظة بور سعيد - بور فؤاد - امام المسجد الكبير - امام المعدية"
              }
            ]
          },
          {
            "supervisorName": "محمد مبروك",
            "outlets": [
              {
                "number": "175",
                "phone": "01206309121",
                "address": "شرم الشيخ ــ حى النور - أمام مجمع المدارس"
              },
              {
                "number": "186",
                "phone": "01204677724",
                "address": "العين السخنة - بورتو السخنة - أمام مطعم ماكدونالدز"
              },
              {
                "number": "209",
                "phone": "01273935865",
                "address":
                    "محافظة السويس - م الاربعين - امتداد ش القسم - أمام موقف السلام"
              },
              {
                "number": "254",
                "phone": "01284419618",
                "address":
                    "محافظة جنوب سيناء - مدينة شرم الشيخ - حي نبق - شارع السلام"
              },
              {
                "number": "312",
                "phone": "01282947165",
                "address":
                    "محافظة جنوب سيناء - مدينة شرم الشيخ - السوق القديم - بجوار معرض السوق القديم"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "شرق الاسكندرية",
        "managerName": "محمد دياب",
        "supervisors": [
          {
            "supervisorName": "محمد عبد النبى",
            "outlets": [
              {
                "number": "27",
                "phone": "01200092706",
                "address":
                    "الإسكندرية - سموحة - شارع فيكتور ايمانويل الثالث - بجوار جراج غرب الدلتا"
              },
              {
                "number": "28",
                "phone": "01200504494",
                "address":
                    "الاسكندرية -عزبة سعد - ميدان عزبة سعد ( ميدان الجامعة )"
              },
              {
                "number": "30",
                "phone": "01212999885",
                "address":
                    "الاسكندريه - سيدي بشر - شارع مصطفي كامل - أمام بنزية شارع القاهره"
              },
              {
                "number": "41",
                "phone": "01275174190",
                "address":
                    "الإسكندرية - السيوف مدخل الفلكي - شارع أديب معقد - بجوار الشهر العقارى القديم"
              },
              {
                "number": "46",
                "phone": "01280529959",
                "address":
                    "الإسكندرية - منطقة بوكلى - ش ابوقير - مزلقان الترام - بجوار محل ليزابيلا"
              },
              {
                "number": "55",
                "phone": "01205644222",
                "address":
                    "الاسكندرية - المندرة بحرى - بجوار كوبرى المندرة - أمام فتح الله"
              },
              {
                "number": "61",
                "phone": "01207800999",
                "address":
                    "الاسكندريه - العوايد - طريق المحمودية - بجوار شركة الادوية - وبجوار وحدة مطافى المحمودية"
              },
              {
                "number": "257",
                "phone": "01284419682",
                "address": "الإسكندرية - جرين بلازا - بجوار مدينة اسيت"
              }
            ]
          },
          {
            "supervisorName": "ماهر جمال",
            "outlets": [
              {
                "number": "38",
                "phone": "01288331386",
                "address":
                    "العصافرة ــ ش جمال عبد الناصر بجوار سور مدرسة عزيز اباظه"
              },
              {
                "number": "116",
                "phone": "01206166440",
                "address":
                    "الاسكندرية - جليم - اول شارع رياض متفرع من شارع ابوقير"
              },
              {
                "number": "154",
                "phone": "01200498059",
                "address":
                    "الاسكندرية - سيدي بشر العسيوي - أمام سور مدافن الشهداء الأتراك - بجوار مطعم بركة"
              },
              {
                "number": "157",
                "phone": "01276187883",
                "address":
                    "الاسكندرية - ميامى - ش جمال عبدالناصر - الاكاديمية البحرية"
              },
              {
                "number": "203",
                "phone": "01270368333",
                "address":
                    "الاسكندرية - شارع جمال عبدالناصر - بجوار سور مستشفى شرق المدينة"
              },
              {
                "number": "204",
                "phone": "01210364952",
                "address":
                    "الاسكندرية - سيدى جابر - أمام محطة قطار سيدى جابر من شارع ابو قير"
              },
              {
                "number": "226",
                "phone": "01203442246",
                "address":
                    "الاسكندرية - سيدى بشر - أمام محطة الترام - أمام مكتبة بريد السرايا"
              },
              {
                "number": "264",
                "phone": "01280782215",
                "address":
                    "الإسكندرية - امام كوبرى الابراهيمية - شارع الشهيد جواد حسنى"
              }
            ]
          },
          {
            "supervisorName": "شعبان احمد",
            "outlets": [
              {
                "number": "42",
                "phone": "01212556632",
                "address":
                    "الإسكندرية - ش أبو قير - أمام مستشفى جمال عبدالناصر - خلف كلية الهندسة"
              },
              {
                "number": "73",
                "phone": "01205715222",
                "address": "الإسكندرية - المنشية الصغيرة - أمام بيت الجملة"
              },
              {
                "number": "99",
                "phone": "01283399500",
                "address":
                    "الاسكندرية - الازريطة - ش الشامبيليون - خلف معرض كوته"
              },
              {
                "number": "101",
                "phone": "01283399372",
                "address":
                    "الاسكندرية - المنشية - بجوار مطعم الجمهورية - أمام محمصة فلورينا"
              },
              {
                "number": "156",
                "phone": "01276187385",
                "address":
                    "الاسكندرية - محرم بك - أمام بنزينة موبيل - أسفل كوبرى محرم بك"
              },
              {
                "number": "252",
                "phone": "01284419589",
                "address": "الاسكندرية - وابور المياه - ميدان أحمد زويل"
              },
              {
                "number": "270",
                "phone": "01210281190",
                "address":
                    "الإسكندرية - الابراهيميه - شارع بورسعيد ميدان سانتريتا."
              }
            ]
          },
          {
            "supervisorName": "محمد دياب",
            "outlets": [
              {
                "number": "159",
                "phone": "01276187818",
                "address":
                    "الاسكندرية - ش مصطفى كامل - مدخل دربالا - بجوار سور شركة البلاستيك"
              },
              {
                "number": "309",
                "phone": "01286455782",
                "address":
                    "الاسكندرية - المندرة - طريق الملاحة - بجوار قسم المنتزة ثالث"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "غرب الاسكندرية",
        "managerName": "اسلام فتحى",
        "supervisors": [
          {
            "supervisorName": "محمد محمود على",
            "outlets": [
              {
                "number": "32",
                "phone": "01210293657",
                "address":
                    "الاسكندرية - ميدان محطة - شارع محرم بك امام الجمعية الاستهلاكية"
              },
              {
                "number": "34",
                "phone": "01220506668",
                "address": "الإسكندرية - العجمي - بجوار مول عجمى ستار"
              },
              {
                "number": "74",
                "phone": "01205713222",
                "address":
                    "الاسكندرية - محطة مصر - شارع عبدالمنعم - أمام مكتب البريد"
              },
              {
                "number": "96",
                "phone": "01283399535",
                "address":
                    "الإسكندرية - العجمي - الهانوفيل - بجوار عمارات سيتي بالاس"
              },
              {
                "number": "165",
                "phone": "01276187573",
                "address": "الاسكندرية - البيطاش - بجوار سور مدرسة مصطفى محمود"
              },
              {
                "number": "182",
                "phone": "01276187960",
                "address": "الإسكندرية - منطقة الدخيلة - أمام مسجد ناجى"
              },
              {
                "number": "258",
                "phone": "01284419686",
                "address":
                    "الإسكندرية - المنشية - شارع سعد زغلول - أمام السنترال ( المصرية للاتصالات )"
              },
              {
                "number": "259",
                "phone": "01284419718",
                "address":
                    "الإسكندرية - مدينة برج العرب الجديدة - ش الفريق سعد الدين الشاذلى - أمام البنزينة"
              },
              {
                "number": "260",
                "phone": "01284419729",
                "address": "أسفل كوبرى ابيس - بالطريق الزراعى - الاسكندرية"
              }
            ]
          },
          {
            "supervisorName": "اسلام فتحى",
            "outlets": [
              {
                "number": "37",
                "phone": "01207869998",
                "address": "الاسكندرية - مرسى مطروح - ش علم الروم"
              },
              {
                "number": "192",
                "phone": "01221169996",
                "address":
                    "الساحل الشمالى - مدخل مدينة الحمام - الطريق الساحلى الشمالى"
              },
              {
                "number": "208",
                "phone": "01273935860",
                "address":
                    "الساحل الشمالى - مدخل مدينة العلمين - بجوار سور شركه المياه"
              },
              {
                "number": "271",
                "phone": "01210279852",
                "address":
                    "الإسكندرية - مدخل مدينة سيدى عبدالرحمن - الساحل الشمالى"
              },
              {
                "number": "282",
                "phone": "01282945205",
                "address":
                    "مرسى مطروح - الساحل الشمالى - مدخل الضبعة - اول شارع مبارك"
              },
              {
                "number": "298",
                "phone": "01282945263",
                "address":
                    "الساحل الشمالى - طريق مطروح الساحل - مدينة رأس الحكمة ."
              }
            ]
          },
          {
            "supervisorName": "محمد السيد",
            "outlets": [
              {
                "number": "56",
                "phone": "01205677222",
                "address": "الاسكندرية - ك 21 - مدخل اكتوبر من الطريق الدولى"
              },
              {
                "number": "194",
                "phone": "01212289997",
                "address":
                    "الاسكندرية - مدينة برج العرب - الحى الاول - بعد كافتيريا قصر الشوق"
              },
              {
                "number": "195",
                "phone": "01211308765",
                "address":
                    "الاسكندرية - مدخل البطاش - بجوار مكتب حى غرب - بجوار مسجد الحديد والصلب."
              },
              {
                "number": "202",
                "phone": "01203978080",
                "address":
                    "الاسكندرية -العجمى - منطقة أبو يوسف -بجوار جامع الرحمة"
              },
              {
                "number": "205",
                "phone": "01206344194",
                "address":
                    "الاسكندرية - العامرية - اول شارع القسم - امام مسجد على الدين."
              },
              {
                "number": "255",
                "phone": "01284419628",
                "address":
                    "الاسكندرية - برج العرب الجديدة - ميدان الداون تاون - بجوار بنك التنمية الصناعية"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "القاهرة وسط (ج)",
        "managerName": "محمد صبحى / محمد ابواليزيد",
        "supervisors": [
          {
            "supervisorName": "محمود السيد على",
            "outlets": [
              {
                "number": "33",
                "phone": "01210207679",
                "address": "شارع شبرا - أمام مول رنين"
              },
              {
                "number": "40",
                "phone": "01220333004",
                "address":
                    "ميدان فيكتوريا ( ميدان نصر الاسلام ) - أمام مسجد نصر الاسلام"
              },
              {
                "number": "48",
                "phone": "01207806061",
                "address": "شبرا الخيمة - أمام كريستال عصفور"
              },
              {
                "number": "52",
                "phone": "01205626222",
                "address": "شارع شبرا - بجوار مدرسة التوفيقية - اول شارع مسره"
              },
              {
                "number": "59",
                "phone": "01205673222",
                "address": "شارع شبرا - بجوار مترو الخلفاوي"
              },
              {
                "number": "127",
                "phone": "01203715099",
                "address": "الوكالة -كورنيش النيل - مدخل السبتية"
              },
              {
                "number": "158",
                "phone": "01276187821",
                "address":
                    "شبرا الخيمه - حى شرق - الشارع الجديد - ش 15 مايو - اسفل الكوبرى الجديد - بجوار كشك أمان ."
              },
              {
                "number": "166",
                "phone": "01276187571",
                "address":
                    "مسطرد - شارع الشعراوي - أمام مسجد المصطفي و معامل البرج"
              },
              {
                "number": "206",
                "phone": "01224560174",
                "address":
                    "القاهرة - شبرا مصر - أبراج إغا خان - بجوار بنك مصر - بالقرب من موقف المظلات"
              }
            ]
          },
          {
            "supervisorName": "عبد الفتاح ابو سريع",
            "outlets": [
              {
                "number": "47",
                "phone": "01205627222",
                "address": "شبرا الخيمة - م المؤسسة - أمام نادى المؤسسة"
              },
              {
                "number": "70",
                "phone": "01205675222",
                "address": "ميدان السيدة زينب - بالقرب من مسجد السيدة زينب"
              },
              {
                "number": "76",
                "phone": "01211446910",
                "address": "العتبة ــ أمام مطعم كنتاكى"
              },
              {
                "number": "81",
                "phone": "01278299245",
                "address": "ميدان باب الشعرية امام السنترال"
              },
              {
                "number": "138",
                "phone": "01270978859",
                "address": "ميدان العباسية - فى الجهة المقابلة لكشرى هند."
              },
              {
                "number": "149",
                "phone": "01212599003",
                "address": "ميدان الجيش -أمام مسجد السلام"
              },
              {
                "number": "164",
                "phone": "01276187925",
                "address": "شبرا الخيمة - مسطرد"
              },
              {
                "number": "189",
                "phone": "01278780157",
                "address": "العتبة بجوار صيدناوي -أمام سنترال العتبة"
              },
              {
                "number": "253",
                "phone": "01284419616",
                "address":
                    "حى الوايلى - ميدان عبده باشا - بجوار كلية هندسة عين شمس"
              },
              {
                "number": "287",
                "phone": "01282945217",
                "address":
                    "القاهرة - الاميرية - ش الكابلات - بجوار شركة السيراميك"
              }
            ]
          },
          {
            "supervisorName": "عبد الخالق عبد الرقيب",
            "outlets": [
              {
                "number": "67",
                "phone": "01205640222",
                "address": "شارع رمسيس بجوار سوق التوفيقية (الاسعاف)"
              },
              {
                "number": "69",
                "phone": "01205604222",
                "address": "ميدان رمسيس - بجوار مسجد الفتح"
              },
              {
                "number": "71",
                "phone": "01205689222",
                "address":
                    "محطة مترو الدمرداش - إمتداد رمسيس مصر والسودان - بجوار دير الملاك والبريد المصرى."
              },
              {
                "number": "217",
                "phone": "01200404029",
                "address":
                    "القاهرة - حى الازبكية - منطقة القللى - قبل نفق شبرا - بجوار التوحيد النور"
              },
              {
                "number": "238",
                "phone": "01282530865",
                "address":
                    "حى حدائق القبة - التقاء شارع ولى العهد مع شارع مصر والسودان - بجوار مدرسة النقراشى"
              },
              {
                "number": "239",
                "phone": "01282530866",
                "address":
                    "القاهرة - ش بورسعيد - بجوار أسواق الشرقية - أمام التوحيد والنور - أمام بنزينة توتال"
              },
              {
                "number": "303",
                "phone": "01286455755",
                "address":
                    "حي المطرية - شارع الحرية - بجوار بنزينة التعاون (محطة التعاون)"
              },
              {
                "number": "304",
                "phone": "01286455753",
                "address": "حي المطرية - منطقة الكاوتش - بجوار مول رنين"
              },
              {
                "number": "1026",
                "phone": "01278298851",
                "address": "القاهرة - الازبكية - 41 ش نجيب الريحانى ارضى 1"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "وسط دلتا أ",
        "managerName": "حسن غازى الهارونى",
        "supervisors": [
          {
            "supervisorName": "ربيع رمضان",
            "outlets": [
              {
                "number": "43",
                "phone": "01212521186",
                "address": "كفر الدوار - امام فتح الله"
              },
              {
                "number": "62",
                "phone": "01207801999",
                "address": "دمنهور- ميدان الساعة - بجوار حديقة الجمهورية"
              },
              {
                "number": "102",
                "phone": "01283399486",
                "address":
                    "دسوق - بميدان مسجد ابراهيم الدسوقي - دوران المسجد الابراهيمى."
              },
              {
                "number": "155",
                "phone": "01283006994",
                "address":
                    "دمنهور - شارع عبد السلام الشاذلي - أمام النادى الاجتماعى"
              },
              {
                "number": "269",
                "phone": "01283843283",
                "address":
                    "محافظة البحيرة - مدينة دمنهور - دوران استاد دمنهور - فى الجهة المقابلة لمدرسة شبرا الاعدادية بنات."
              },
              {
                "number": "275",
                "phone": "01210277303",
                "address":
                    "محافظة البحيرة - ايتاى ابارود - ش الجمهورية - بجوار شركة المياة و الصرف المغطى - أمام سوق الكهرباء - بالقرب من المستشفى العام ."
              }
            ]
          },
          {
            "supervisorName": "على طه محمود",
            "outlets": [
              {
                "number": "91",
                "phone": "01283398801",
                "address": "المنصورة - ش عبدالسلام عارف - أمام السنترال"
              },
              {
                "number": "98",
                "phone": "01283399509",
                "address": "المنصوره - ش 2 قناة السويس - أمام مصنع الالبان"
              },
              {
                "number": "106",
                "phone": "01211444974",
                "address": "السنبلاوين - أمام محطة القطار"
              },
              {
                "number": "107",
                "phone": "01211444984",
                "address":
                    "شربين - شارع الجيش - أمام الشركة المصرية للإتصالات ( سنترال شربين )"
              },
              {
                "number": "108",
                "phone": "01211444986",
                "address": "دكرنس - شارع العروبة - بجوار مجوهرات محمد شبانة"
              },
              {
                "number": "110",
                "phone": "01210275160",
                "address": "المنصورة - ش بورسعيد - أمام فندق عمر أفندى"
              },
              {
                "number": "118",
                "phone": "01203977070",
                "address": "المنصور - ش الجلاء - امام مدرسة شجرة الدر"
              },
              {
                "number": "153",
                "phone": "01221708797",
                "address":
                    "المنصوره - شارع الجيش - أمام استاد المنصورة الرياضى - بجوار اولاد رجب"
              },
              {
                "number": "198",
                "phone": "01210279614",
                "address":
                    "محافظة الدقهلية - المنصورة - أمتداد شارع جيهان - بجوار سور القرية الالومبية"
              },
              {
                "number": "278",
                "phone": "01287436803",
                "address":
                    "محافظة الدقهلية - المنصورة - ش الجيش بجوار معهد المنصوره الازهري أمام مسجد الشناوي"
              },
              {
                "number": "314",
                "phone": "01275186577",
                "address":
                    "المنصورة - طلخا - نزلة كوبرى طلخا الجديد - بعد قسم شرطة طلخا - بجوار موقف مركز طلخا"
              },
              {
                "number": "315",
                "phone": "01210360653",
                "address": "المنصورة - ش احمد ماهر - بجوار محل ماء الذهب للعطور"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "وسط دلتا ب",
        "managerName": "محمد رمضان",
        "supervisors": [
          {
            "supervisorName": "احمد نبيل",
            "outlets": [
              {
                "number": "78",
                "phone": "01211447672",
                "address": "طنطا - مؤقف الجلاء القديم - أمام مدرسة الناسجية"
              },
              {
                "number": "79",
                "phone": "01211449381",
                "address":
                    "طنطا - بجوار السجل المدنى - وبجوار المحكمة - فى الجهة المقابلة لمحطة قطارات طنطا"
              },
              {
                "number": "93",
                "phone": "01211411832",
                "address":
                    "كفر الشيخ - شارع ابو العلاء المعري - أمام مسجد كفر الشيخ الرياضي - والاستاد الرياضى"
              },
              {
                "number": "120",
                "phone": "01202399907",
                "address":
                    "\"كفر الزيات - ميدان المحطة - أمام بنك القاهرة , والبنك الاهلى - بجوار سور نادى كفر الزيات .\""
              },
              {
                "number": "133",
                "phone": "01270978994",
                "address": "طنطا - المعرض - بجوار الطريق الزراعى"
              },
              {
                "number": "179",
                "phone": "01206343716",
                "address":
                    "كفر الشيخ ــ في الجهة المقابلة لمديرية التربية والتعليم - بجوار قصر الثقافة"
              },
              {
                "number": "284",
                "phone": "01282945210",
                "address":
                    "محافظة كفر الشيخ - ميدان سيدي قطب - أمام مديرية الصحة وادارة الأوقاف"
              }
            ]
          },
          {
            "supervisorName": "خالد عمرو",
            "outlets": [
              {
                "number": "80",
                "phone": "01288075189",
                "address":
                    "قليوب - أمام مزلقان قليوب - ناحية مستشفى قليوب العام ."
              },
              {
                "number": "86",
                "phone": "01223456166",
                "address": "بنها - شارع جانبي (ش النجدة) متفرع من فريد ندا"
              },
              {
                "number": "87",
                "phone": "01212531256",
                "address": "بنها - شارع سعد زغلول - بجوار تمثال سعد زغلول"
              },
              {
                "number": "117",
                "phone": "01211322422",
                "address": "طوخ - أمام السنترال - بجوار كشرى الونش"
              },
              {
                "number": "137",
                "phone": "01270978854",
                "address": "مدينة باسوس - أسفل كوبرى دائرى بسوس"
              },
              {
                "number": "171",
                "phone": "01206183526",
                "address": "مدينة القناطر ــ أمام البنك الاهلى"
              }
            ]
          },
          {
            "supervisorName": "محمود جمال",
            "outlets": [
              {
                "number": "82",
                "phone": "01278299503",
                "address":
                    "المحلة الكبري - البنزيون - أمام بنك مصر من شارع البحر"
              },
              {
                "number": "105",
                "phone": "01211444923",
                "address":
                    "الدقهلية - ميت غمر - امام البنك الاهلي ومكتب بريد ميت غمر"
              },
              {
                "number": "119",
                "phone": "01206142229",
                "address": "المحلة الكبري - ميدان الشئون - بجوار قسم ثانى"
              },
              {
                "number": "129",
                "phone": "01270978926",
                "address": "بركة السبع - ميدان بركة السبع"
              },
              {
                "number": "148",
                "phone": "01227861080",
                "address": "الغربية - زفتى - شارع الجيش - امام مجلس المدينة"
              }
            ]
          },
          {
            "supervisorName": "احمد منتصر",
            "outlets": [
              {
                "number": "104",
                "phone": "01283398896",
                "address":
                    "شبين الكوم - فى الجهة المقابله لإستاد شبين الكوم الرياضي - بجوار سور مستشفي الرمد"
              },
              {
                "number": "111",
                "phone": "01200404025",
                "address": "شبين الكوم - البر الشرقى بجوار مدرية الزراعة"
              },
              {
                "number": "123",
                "phone": "01202396665",
                "address":
                    "المنوفية - مدينة السادات - السوق التجاري - المنطقة الرابعة"
              },
              {
                "number": "130",
                "phone": "01270978932",
                "address": "الباجور - الميدان - أمام المحكمة اسف الكوبرى العلوى"
              },
              {
                "number": "132",
                "phone": "01206318898",
                "address":
                    "منوف - شارع بورسعيد - ميدان الشهداء بجوار حديقة تحيا مصر وامام مجلس المدينة"
              },
              {
                "number": "147",
                "phone": "01225304317",
                "address":
                    "المنوفية - اشمون - ميدان فليفل ( المسلة ) - أمام مكتبة الطفل وشارع محطة القطار"
              }
            ]
          }
        ]
      },
      {
        "sectorName": "صعيد مصر",
        "managerName": "هشام محمد الملقب",
        "supervisors": [
          {
            "supervisorName": "اسلام عثمان",
            "outlets": [
              {
                "number": "97",
                "phone": "01283399522",
                "address":
                    "محافظة بنى سويف - مدينة الواسطى - امتداد شارع عرابى بميدان الواسطى - بجوار الكوبرى"
              },
              {
                "number": "103",
                "phone": "01211419991",
                "address": "الفيوم - شارع السنترال"
              },
              {
                "number": "114",
                "phone": "01203440001",
                "address": "بني سويف - ش عبدالسلام عارف - م الزراعيين"
              },
              {
                "number": "126",
                "phone": "01203717702",
                "address": "المنيا - اول شارع طه حسين تقاطع مع ش مستشفى الاميرى"
              },
              {
                "number": "135",
                "phone": "01270979013",
                "address":
                    "بني سويف الجديدة - شرق النيل - بجوار ديوان المحافظة - مدخل المدينة - اما مول الشروق ومعمل البرج ."
              },
              {
                "number": "161",
                "phone": "01276187581",
                "address": "المنيا - ملوى - أمام مدرسة الثانوية بنات"
              },
              {
                "number": "176",
                "phone": "01206308992",
                "address": "المنيا ــ مغاغة ش السلام - بجوار محطة القطار"
              },
              {
                "number": "178",
                "phone": "01206188904",
                "address": "مدينة الفيوم ــ بجوار كشرى السواقى"
              },
              {
                "number": "261",
                "phone": "01284419782",
                "address":
                    "محافظة المنيا - مدينة المنيا الجديدة - الحي الرابع - ميدان الشباب ."
              },
              {
                "number": "292",
                "phone": "01282945241",
                "address":
                    "محافظة المنيا - مركز بنى مزار - ش الجمهورية - أمام السنترال"
              },
              {
                "number": "317",
                "phone": "01226233423",
                "address": "محافطة اسيوط - حى غرب - ميدان المجذوب"
              }
            ]
          },
          {
            "supervisorName": "اسلام عبدالغفار",
            "outlets": [
              {
                "number": "121",
                "phone": "01202399905",
                "address": "قنا - ميدان الساعة - البنزيون"
              },
              {
                "number": "124",
                "phone": "01202396664",
                "address": "اسيوط ش الجمهورية - أمام مبنى المساحة"
              },
              {
                "number": "125",
                "phone": "01202388829",
                "address": "سوهاج - ميدان الثقافة"
              },
              {
                "number": "134",
                "phone": "01270978995",
                "address": "قنا - أمام مسجد سيدي عبد الرحيم"
              },
              {
                "number": "136",
                "phone": "01270979037",
                "address":
                    "أسيوط - ش الازهر - أمام مستشفى الصدر - فى الجهة المقابلة لمطعم اربياتا"
              },
              {
                "number": "140",
                "phone": "01275197793",
                "address": "اسيوط - شارع الهلالي - بجوار مسجد الهلالي"
              },
              {
                "number": "143",
                "phone": "01271254311",
                "address": "سوهاج - طريق اخميم - بجوار مصرف ابو ظبى"
              },
              {
                "number": "151",
                "phone": "01279693355",
                "address":
                    "سوهاج - مدينة طهطا -أمام سنترال WE - وأمام صندواى - فى الجهة المقابلة لمسجد الخلواتيه."
              },
              {
                "number": "184",
                "phone": "01206197548",
                "address":
                    "قنا ــ نجع حمادى - شارع بورسعيد - بجوار بنك الإسكندرية"
              },
              {
                "number": "215",
                "phone": "01273936521",
                "address":
                    "محافظة سوهاج - مركز البلينا - مسجد الشاذليه - أمام المصرية للصرافة."
              },
              {
                "number": "286",
                "phone": "01282945216",
                "address":
                    "محافظة اسيوط - القوصيه - شارع الجلاء - بجوار مركز النصر الرياضي"
              }
            ]
          },
          {
            "supervisorName": "محمد عمر مصطفى",
            "outlets": [
              {
                "number": "144",
                "phone": "01202388821",
                "address": "الاقصر - ش المنشية - بجوار مدرسة صلاح الدين"
              },
              {
                "number": "170",
                "phone": "01206244324",
                "address": "الغردقة ش النصر منطقة البنوك اول ش الإستاد"
              },
              {
                "number": "187",
                "phone": "01271357410",
                "address": "اسوان ــ ش السوق السياحى - بجوار كشرى الصفوة ."
              },
              {
                "number": "256",
                "phone": "01284419681",
                "address":
                    "مدينة الغردقة - منطقة الاحياء - حى الفيروز - أمام بنك مصر"
              },
              {
                "number": "266",
                "phone": "01280782239",
                "address":
                    "محافظة اسوان - مدينة اسوان - ش أبو سمبل - بجوار مول بلازا"
              },
              {
                "number": "272",
                "phone": "01210278177",
                "address":
                    "محافظة اسوان - مدينة إدفو - الميدان القبلى - امام مسجد الامام على بن ابى طالب ."
              },
              {
                "number": "273",
                "phone": "01210278161",
                "address":
                    "محافظة قنا - مدينة قوص - شرق المزلقان - أسفل كوبرى المزلقان"
              },
              {
                "number": "276",
                "phone": "01210277246",
                "address": "محافظة الأقصر - مدينة إسنا - بجوار السجل المدنى"
              },
              {
                "number": "311",
                "phone": "01282947162",
                "address":
                    "محافظة الاقصر -شارع المدينة المنورة - بجوار سور نادى المدينة المنورة"
              },
              {
                "number": "313",
                "phone": "01279693373",
                "address": "محافظة الاقصر - أمام مجمع مواقف ارمنت (شرق و غرب)"
              }
            ]
          }
        ]
      }
    ];
  }
}

// -------------------------------------------------------------------
// Main Screen: Displays a list of sectors
// -------------------------------------------------------------------
class DataManagementScreen extends StatelessWidget {
  const DataManagementScreen({super.key});

  void _showSectorDialog(BuildContext context, {DocumentSnapshot? sectorDoc}) {
    final nameController = TextEditingController(text: sectorDoc?['name']);
    final managerController =
        TextEditingController(text: sectorDoc?['managerName']);

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: Text(sectorDoc == null ? 'إضافة قطاع' : 'تعديل قطاع'),
        content: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            TextField(
                controller: nameController,
                decoration: const InputDecoration(labelText: 'اسم القطاع')),
            TextField(
                controller: managerController,
                decoration:
                    const InputDecoration(labelText: 'اسم مدير القطاع')),
          ],
        ),
        actions: [
          TextButton(
              onPressed: () => Navigator.of(context).pop(),
              child: const Text('إلغاء')),
          ElevatedButton(
            onPressed: () {
              if (nameController.text.isNotEmpty &&
                  managerController.text.isNotEmpty) {
                final data = {
                  'name': nameController.text.trim(),
                  'managerName': managerController.text.trim(),
                };
                if (sectorDoc == null) {
                  FirebaseFirestore.instance.collection('sectors').add(data);
                } else {
                  sectorDoc.reference.update(data);
                }
                Navigator.of(context).pop();
              }
            },
            child: const Text('حفظ'),
          ),
        ],
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('إدارة بيانات القطاعات'),
        backgroundColor: Colors.indigo,
        foregroundColor: Colors.white,
        actions: [
          // IMPORTANT: This is a temporary button to upload the initial data.
          // Press it ONCE to populate Firestore. Then you can remove it.
          IconButton(
            icon: const Icon(Icons.upload_file),
            tooltip: 'Upload Initial Data',
            onPressed: () => DataUploader().uploadAllData(context),
          ),
        ],
      ),
      body: StreamBuilder<QuerySnapshot>(
        stream: FirebaseFirestore.instance
            .collection('sectors')
            .orderBy('name')
            .snapshots(),
        builder: (context, snapshot) {
          if (snapshot.connectionState == ConnectionState.waiting) {
            return const Center(child: CircularProgressIndicator());
          }
          if (snapshot.hasError) {
            return Center(child: Text('حدث خطأ: ${snapshot.error}'));
          }
          if (!snapshot.hasData || snapshot.data!.docs.isEmpty) {
            return const Center(
              child: Padding(
                padding: EdgeInsets.all(16.0),
                child: Text(
                    'لا توجد قطاعات. اضغط على زر (+) لإضافة قطاع أو زر (↑) لرفع البيانات الأولية.',
                    textAlign: TextAlign.center),
              ),
            );
          }
          return ListView.builder(
            itemCount: snapshot.data!.docs.length,
            itemBuilder: (context, index) {
              final sectorDoc = snapshot.data!.docs[index];
              return Card(
                margin: const EdgeInsets.symmetric(horizontal: 10, vertical: 5),
                child: ListTile(
                  leading: const Icon(Icons.business, color: Colors.indigo),
                  title: Text(sectorDoc['name']),
                  subtitle: Text('المدير: ${sectorDoc['managerName']}'),
                  trailing: IconButton(
                    icon: const Icon(Icons.edit, color: Colors.blue),
                    onPressed: () =>
                        _showSectorDialog(context, sectorDoc: sectorDoc),
                  ),
                  onTap: () => Navigator.of(context).push(MaterialPageRoute(
                    builder: (_) => SectorDetailScreen(sectorDoc: sectorDoc),
                  )),
                ),
              );
            },
          );
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () => _showSectorDialog(context),
        backgroundColor: Colors.indigo,
        foregroundColor: Colors.white,
        child: const Icon(Icons.add),
      ),
    );
  }
}

// -------------------------------------------------------------------
// Sector Detail Screen: Shows the hierarchy for a single sector
// -------------------------------------------------------------------
class SectorDetailScreen extends StatelessWidget {
  final DocumentSnapshot sectorDoc;
  const SectorDetailScreen({super.key, required this.sectorDoc});

  // MODIFIED: This now opens a stateful dialog to handle moving
  void _showSupervisorDialog(BuildContext context,
      {DocumentSnapshot? supervisorDoc}) {
    showDialog(
      context: context,
      builder: (context) => _EditSupervisorDialog(
        supervisorDoc: supervisorDoc,
        // Pass the current sector ID for the initial dropdown value
        currentSectorId: sectorDoc.id,
      ),
    );
  }

  void _confirmDelete(BuildContext context, DocumentReference docRef) {
    showDialog(
        context: context,
        builder: (context) => AlertDialog(
              title: const Text('تأكيد الحذف'),
              content: const Text('هل أنت متأكد من رغبتك في حذف هذا العنصر؟'),
              actions: [
                TextButton(
                    onPressed: () => Navigator.of(context).pop(),
                    child: const Text('إلغاء')),
                ElevatedButton(
                    onPressed: () {
                      docRef.delete();
                      Navigator.of(context).pop();
                    },
                    style:
                        ElevatedButton.styleFrom(backgroundColor: Colors.red),
                    child: const Text('حذف'))
              ],
            ));
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('قطاع: ${sectorDoc['name']}'),
        backgroundColor: Colors.indigo,
        foregroundColor: Colors.white,
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(8.0),
        child: Column(
          children: [
            Card(
              elevation: 4,
              child: ListTile(
                title: Text('مدير القطاع: ${sectorDoc['managerName']}',
                    style: const TextStyle(
                        fontWeight: FontWeight.bold, fontSize: 18)),
              ),
            ),
            const Divider(height: 20),
            StreamBuilder<QuerySnapshot>(
              stream: FirebaseFirestore.instance
                  .collection('supervisors')
                  .where('sectorId', isEqualTo: sectorDoc.id)
                  .snapshots(),
              builder: (context, snapshot) {
                if (!snapshot.hasData) {
                  return const Center(child: CircularProgressIndicator());
                }
                if (snapshot.data!.docs.isEmpty) {
                  return const Center(
                      child: Text('لا يوجد مشرفون لهذا القطاع.'));
                }
                return ListView.builder(
                  shrinkWrap: true,
                  physics: const NeverScrollableScrollPhysics(),
                  itemCount: snapshot.data!.docs.length,
                  itemBuilder: (context, index) {
                    final supervisorDoc = snapshot.data!.docs[index];
                    return Card(
                      margin: const EdgeInsets.symmetric(vertical: 4.0),
                      color: Colors.grey[200],
                      child: ExpansionTile(
                        title: Text('المشرف: ${supervisorDoc['name']}',
                            style: const TextStyle(
                                fontWeight: FontWeight.bold, fontSize: 16)),
                        trailing: Row(
                          mainAxisSize: MainAxisSize.min,
                          children: [
                            IconButton(
                                icon:
                                    const Icon(Icons.edit, color: Colors.blue),
                                onPressed: () => _showSupervisorDialog(context,
                                    supervisorDoc: supervisorDoc)),
                            IconButton(
                                icon:
                                    const Icon(Icons.delete, color: Colors.red),
                                onPressed: () => _confirmDelete(
                                    context, supervisorDoc.reference)),
                          ],
                        ),
                        children: [_buildOutletsList(context, supervisorDoc)],
                      ),
                    );
                  },
                );
              },
            ),
          ],
        ),
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () => _showSupervisorDialog(context),
        tooltip: 'إضافة مشرف جديد',
        backgroundColor: Colors.indigo,
        foregroundColor: Colors.white,
        child: const Icon(Icons.person_add),
      ),
    );
  }

  Widget _buildOutletsList(
      BuildContext context, DocumentSnapshot supervisorDoc) {
    // MODIFIED: This now opens a stateful dialog to handle moving
    void _showOutletDialog(BuildContext context,
        {DocumentSnapshot? outletDoc}) {
      showDialog(
        context: context,
        builder: (context) => _EditOutletDialog(
          outletDoc: outletDoc,
          currentSupervisorId: supervisorDoc.id,
          currentSectorId: sectorDoc.id,
        ),
      );
    }

    return Column(
      children: [
        StreamBuilder<QuerySnapshot>(
          stream: FirebaseFirestore.instance
              .collection('outlets')
              .where('supervisorId', isEqualTo: supervisorDoc.id)
              .snapshots(),
          builder: (context, snapshot) {
            if (!snapshot.hasData) return const SizedBox.shrink();
            final docs = snapshot.data!.docs;
            docs.sort((a, b) {
              int numA = int.tryParse(a['number'] ?? '0') ?? 0;
              int numB = int.tryParse(b['number'] ?? '0') ?? 0;
              return numA.compareTo(numB);
            });
            return ListView.builder(
              shrinkWrap: true,
              physics: const NeverScrollableScrollPhysics(),
              itemCount: docs.length,
              itemBuilder: (context, index) {
                final outletDoc = docs[index];
                return ListTile(
                  leading: CircleAvatar(
                      backgroundColor: Colors.indigo.withOpacity(0.2),
                      child: Text(outletDoc['number'])),
                  title: Text("هاتف: ${outletDoc['phone']}"),
                  subtitle: Text(outletDoc['address']),
                  trailing: Row(
                    mainAxisSize: MainAxisSize.min,
                    children: [
                      IconButton(
                          icon: const Icon(Icons.edit,
                              size: 20, color: Colors.blueAccent),
                          onPressed: () =>
                              _showOutletDialog(context, outletDoc: outletDoc)),
                      IconButton(
                          icon: const Icon(Icons.delete,
                              size: 20, color: Colors.redAccent),
                          onPressed: () =>
                              _confirmDelete(context, outletDoc.reference)),
                    ],
                  ),
                );
              },
            );
          },
        ),
        Padding(
          padding: const EdgeInsets.only(right: 16.0, bottom: 8.0),
          child: Align(
            alignment: Alignment.centerRight,
            child: TextButton.icon(
              icon: const Icon(Icons.add_circle_outline),
              label: const Text('إضافة منفذ جديد'),
              onPressed: () => _showOutletDialog(context),
            ),
          ),
        ),
      ],
    );
  }
}

// -------------------------------------------------------------------
// NEW: Stateful Dialog for Adding/Editing/Moving a Supervisor
// -------------------------------------------------------------------
class _EditSupervisorDialog extends StatefulWidget {
  final DocumentSnapshot? supervisorDoc;
  final String currentSectorId;

  const _EditSupervisorDialog(
      {this.supervisorDoc, required this.currentSectorId});

  @override
  _EditSupervisorDialogState createState() => _EditSupervisorDialogState();
}

class _EditSupervisorDialogState extends State<_EditSupervisorDialog> {
  final _nameController = TextEditingController();
  String? _selectedSectorId;
  List<QueryDocumentSnapshot> _sectors = [];
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    if (widget.supervisorDoc != null) {
      _nameController.text = widget.supervisorDoc!['name'];
      _selectedSectorId = widget.supervisorDoc!['sectorId'];
    } else {
      _selectedSectorId = widget.currentSectorId;
    }
    _fetchSectors();
  }

  Future<void> _fetchSectors() async {
    try {
      final snapshot = await FirebaseFirestore.instance
          .collection('sectors')
          .orderBy('name')
          .get();
      if (mounted) {
        setState(() {
          _sectors = snapshot.docs;
          _isLoading = false;
        });
      }
    } catch (e) {
      // Handle error if needed
      if (mounted) {
        setState(() => _isLoading = false);
      }
    }
  }

  void _onSave() {
    if (_nameController.text.isNotEmpty && _selectedSectorId != null) {
      final data = {
        'name': _nameController.text.trim(),
        'sectorId': _selectedSectorId,
      };
      if (widget.supervisorDoc == null) {
        FirebaseFirestore.instance.collection('supervisors').add(data);
      } else {
        widget.supervisorDoc!.reference.update(data);
      }
      Navigator.of(context).pop();
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Text(widget.supervisorDoc == null ? 'إضافة مشرف' : 'تعديل مشرف'),
      content: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                TextField(
                  controller: _nameController,
                  decoration: const InputDecoration(labelText: 'اسم المشرف'),
                ),
                const SizedBox(height: 16),
                DropdownButtonFormField<String>(
                  value: _selectedSectorId,
                  decoration: const InputDecoration(labelText: 'القطاع'),
                  items: _sectors.map((doc) {
                    return DropdownMenuItem(
                      value: doc.id,
                      child: Text(doc['name']),
                    );
                  }).toList(),
                  onChanged: (value) {
                    setState(() {
                      _selectedSectorId = value;
                    });
                  },
                ),
              ],
            ),
      actions: [
        TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('إلغاء')),
        ElevatedButton(onPressed: _onSave, child: const Text('حفظ')),
      ],
    );
  }
}

// -------------------------------------------------------------------
// NEW: Stateful Dialog for Adding/Editing/Moving an Outlet
// -------------------------------------------------------------------
class _EditOutletDialog extends StatefulWidget {
  final DocumentSnapshot? outletDoc;
  final String currentSupervisorId;
  final String currentSectorId;

  const _EditOutletDialog({
    this.outletDoc,
    required this.currentSupervisorId,
    required this.currentSectorId,
  });

  @override
  _EditOutletDialogState createState() => _EditOutletDialogState();
}

class _EditOutletDialogState extends State<_EditOutletDialog> {
  final _numberController = TextEditingController();
  final _phoneController = TextEditingController();
  final _addressController = TextEditingController();
  String? _selectedSupervisorId;

  Map<String, String> _supervisorSectorMap = {}; // supervisorId -> sectorId
  Map<String, String> _sectorNameMap = {}; // sectorId -> sectorName
  List<QueryDocumentSnapshot> _supervisors = [];
  bool _isLoading = true;

  @override
  void initState() {
    super.initState();
    if (widget.outletDoc != null) {
      _numberController.text = widget.outletDoc!['number'];
      _phoneController.text = widget.outletDoc!['phone'];
      _addressController.text = widget.outletDoc!['address'];
      _selectedSupervisorId = widget.outletDoc!['supervisorId'];
    } else {
      _selectedSupervisorId = widget.currentSupervisorId;
    }
    _fetchData();
  }

  Future<void> _fetchData() async {
    try {
      final sectorsSnapshot =
          await FirebaseFirestore.instance.collection('sectors').get();
      final supervisorsSnapshot = await FirebaseFirestore.instance
          .collection('supervisors')
          .orderBy('name')
          .get();

      final sectorNames = {
        for (var doc in sectorsSnapshot.docs) doc.id: doc['name'] as String
      };
      final supervisorSectors = {
        for (var doc in supervisorsSnapshot.docs)
          doc.id: doc['sectorId'] as String
      };
      if (mounted) {
        setState(() {
          _supervisors = supervisorsSnapshot.docs;
          _sectorNameMap = sectorNames;
          _supervisorSectorMap = supervisorSectors;
          _isLoading = false;
        });
      }
    } catch (e) {
      if (mounted) setState(() => _isLoading = false);
    }
  }

  void _onSave() {
    if (_numberController.text.isNotEmpty && _selectedSupervisorId != null) {
      final newSectorId = _supervisorSectorMap[_selectedSupervisorId!];
      final data = {
        'number': _numberController.text.trim(),
        'phone': _phoneController.text.trim(),
        'address': _addressController.text.trim(),
        'supervisorId': _selectedSupervisorId,
        'sectorId': newSectorId, // Update sectorId for consistency
      };
      if (widget.outletDoc == null) {
        FirebaseFirestore.instance.collection('outlets').add(data);
      } else {
        widget.outletDoc!.reference.update(data);
      }
      Navigator.of(context).pop();
    }
  }

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: Text(widget.outletDoc == null ? 'إضافة منفذ' : 'تعديل منفذ'),
      content: _isLoading
          ? const Center(child: CircularProgressIndicator())
          : SingleChildScrollView(
              child: Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  DropdownButtonFormField<String>(
                    value: _selectedSupervisorId,
                    decoration: const InputDecoration(labelText: 'المشرف'),
                    items: _supervisors.map((doc) {
                      final sectorName =
                          _sectorNameMap[doc['sectorId']] ?? 'N/A';
                      return DropdownMenuItem(
                        value: doc.id,
                        child: Text('${doc['name']} ($sectorName)'),
                      );
                    }).toList(),
                    onChanged: (value) {
                      setState(() {
                        _selectedSupervisorId = value;
                      });
                    },
                  ),
                  const SizedBox(height: 16),
                  TextField(
                      controller: _numberController,
                      decoration:
                          const InputDecoration(labelText: 'رقم المنفذ'),
                      keyboardType: TextInputType.number),
                  TextField(
                      controller: _phoneController,
                      decoration:
                          const InputDecoration(labelText: 'رقم الهاتف'),
                      keyboardType: TextInputType.phone),
                  TextField(
                      controller: _addressController,
                      decoration: const InputDecoration(labelText: 'العنوان')),
                ],
              ),
            ),
      actions: [
        TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: const Text('إلغاء')),
        ElevatedButton(onPressed: _onSave, child: const Text('حفظ')),
      ],
    );
  }
}
